# 绝区零 Seelie 扩展开发计划

## 项目概述
基于原神 SeelieEx 脚本改造，为绝区零制作自动导入角色数据到 Seelie 规划工具的用户脚本。

## 当前状态分析

### ✅ 已完成
- [x] 项目结构清理（移除原神和星穹铁道代码）
- [x] 基础配置更新（vite.config.ts, package.json）
- [x] 绝区零数据文件准备（角色和武器列表）
- [x] 基础 API 端点配置
- [x] 爬虫脚本适配

### ❌ 需要解决的问题
- [x] **依赖问题**: ~~axios 和 axios-userscript-adapter 模块缺失~~ (已修复，使用 @trim21/gm-fetch)
- [ ] **API 适配**: 绝区零 API 结构与原神不同
- [ ] **数据结构**: 绝区零角色数据结构需要重新定义
- [ ] **元素属性**: 绝区零使用属性系统而非元素系统
- [ ] **天赋系统**: 绝区零的技能系统与原神不同
- [ ] **UI 组件**: 需要检查和适配用户界面
- [ ] **类型定义**: TypeScript 类型需要更新

---

## 开发计划

### 阶段 1: 环境修复 (优先级: 🔴 高)
**预计时间**: 1-2 天

#### 1.1 依赖修复
- [x] ~~修复 axios 相关依赖问题~~ (已完成，替换为 @trim21/gm-fetch)
- [x] ~~修复 TypeScript 类型冲突~~ (已完成，更新 TypeScript 和 @types/node 版本)
- [ ] 检查 package.json 中的依赖版本
- [ ] 确保 tampermonkey 相关库正常工作

#### 1.2 构建系统验证
- [x] ~~验证 vite 构建配置~~ (已完成)
- [x] ~~测试用户脚本生成~~ (已完成，生成 dist/index.user.js)
- [x] ~~确保资源文件正确引用~~ (已完成)

### 阶段 2: API 研究与适配 (优先级: 🔴 高)
**预计时间**: 3-5 天

#### 2.1 绝区零 API 调研
- [ ] 研究绝区零米游社 API 结构
  - 角色基础信息 API
  - 角色详细信息 API
  - 武器信息 API
  - 认证和设备指纹要求
- [ ] 对比原神 API，找出差异点
- [ ] 测试 API 调用和参数

#### 2.2 API 接口适配
- [ ] 更新 `src/hoyo.ts` 中的 API 调用逻辑
- [ ] 适配绝区零的请求参数格式
- [ ] 处理绝区零特有的认证流程
- [ ] 错误处理和重试机制

### 阶段 3: 数据结构重构 (优先级: 🟡 中)
**预计时间**: 2-3 天

#### 3.1 TypeScript 类型定义
- [ ] 更新 `src/@type/mihoyo.d.ts`
  - 绝区零角色数据结构
  - 武器数据结构
  - 技能数据结构
  - 装备数据结构
- [ ] 创建绝区零专用的类型定义

#### 3.2 数据转换逻辑
- [ ] 更新 `src/seelie.ts` 中的数据转换
- [ ] 适配绝区零的等级系统
- [ ] 处理绝区零的属性系统（替代元素系统）
- [ ] 适配技能升级系统

#### 3.3 查询系统更新
- [ ] 更新 `src/query.ts`
- [ ] 绝区零角色名称映射
- [ ] 武器名称映射
- [ ] 属性系统映射

### 阶段 4: 核心功能实现 (优先级: 🟡 中)
**预计时间**: 3-4 天

#### 4.1 角色数据获取
- [ ] 实现绝区零角色列表获取
- [ ] 实现角色详细信息获取
- [ ] 武器信息获取
- [ ] 技能等级信息获取

#### 4.2 数据导入功能
- [ ] 角色等级导入
- [ ] 武器等级导入
- [ ] 技能等级导入
- [ ] 批量导入功能

#### 4.3 Seelie 数据格式适配
- [ ] 研究绝区零 Seelie 的数据格式
- [ ] 适配 localStorage 数据结构
- [ ] 确保数据正确显示在 Seelie 中

### 阶段 5: UI 界面适配 (优先级: 🟢 低)
**预计时间**: 2-3 天

#### 5.1 界面组件检查
- [ ] 检查 `src/components/SeelieExDialog.tsx`
- [ ] 适配绝区零相关的 UI 文本
- [ ] 更新菜单项和按钮文本

#### 5.2 用户体验优化
- [ ] 添加绝区零特有的功能选项
- [ ] 优化错误提示信息
- [ ] 添加进度指示器

### 阶段 6: 测试与优化 (优先级: 🟡 中)
**预计时间**: 2-3 天

#### 6.1 功能测试
- [ ] 账户绑定测试
- [ ] 角色数据获取测试
- [ ] 数据导入测试
- [ ] 错误场景测试

#### 6.2 性能优化
- [ ] API 调用优化
- [ ] 数据缓存机制
- [ ] 错误重试机制

#### 6.3 兼容性测试
- [ ] 不同浏览器测试
- [ ] Tampermonkey 版本兼容性
- [ ] Seelie 网站更新适配

---

## 技术难点与解决方案

### 1. 绝区零 API 差异
**问题**: 绝区零的 API 结构可能与原神不同
**解决方案**: 
- 使用浏览器开发者工具抓包分析
- 参考现有的绝区零相关项目
- 逐步测试和调试 API 调用

### 2. 属性系统差异
**问题**: 绝区零使用属性系统而非元素系统
**解决方案**:
- 更新 `elementAttrIds` 映射表
- 适配绝区零的属性类型
- 更新相关的查询和转换逻辑

### 3. 技能系统差异
**问题**: 绝区零的技能系统与原神不同
**解决方案**:
- 研究绝区零的技能升级机制
- 适配技能等级范围和升级材料
- 更新技能相关的数据结构

### 4. Seelie 数据格式
**问题**: 需要确保数据正确导入到绝区零 Seelie
**解决方案**:
- 分析绝区零 Seelie 的 localStorage 结构
- 对比原神版本的差异
- 测试数据导入效果

---

## 开发环境准备

### 必需工具
- Node.js (推荐 v16+)
- npm 或 yarn
- Tampermonkey 浏览器扩展
- 绝区零游戏账号（用于测试）

### 开发流程
1. `npm install` - 安装依赖
2. `npm run dev` - 开发模式
3. `npm run build` - 构建用户脚本
4. 在 Tampermonkey 中安装测试

### 调试建议
- 使用浏览器开发者工具监控网络请求
- 在 `https://zzz.seelie.me` 上测试功能
- 使用 console.log 调试数据流
- 保存测试用的 API 响应数据

---

## 风险评估

### 高风险
- **API 变更**: 米游社 API 可能随时变更
- **反爬虫**: 可能遇到更严格的反爬虫机制

### 中风险
- **数据结构**: 绝区零数据结构可能复杂
- **Seelie 更新**: 目标网站可能更新

### 低风险
- **浏览器兼容性**: 现代浏览器支持良好
- **用户脚本机制**: Tampermonkey 生态稳定

---

## 成功标准

### 最小可行产品 (MVP)
- [ ] 能够获取绝区零角色基础信息
- [ ] 能够导入角色等级到 Seelie
- [ ] 基本的错误处理和用户提示

### 完整功能
- [ ] 完整的角色、武器、技能数据导入
- [ ] 批量操作功能
- [ ] 良好的用户体验
- [ ] 稳定的错误处理

### 优化目标
- [ ] 快速的数据获取和导入
- [ ] 智能的数据缓存
- [ ] 详细的操作日志和反馈

---

## 后续维护

### 定期任务
- 监控米游社 API 变化
- 更新角色和武器数据
- 适配 Seelie 网站更新
- 处理用户反馈和 bug 报告

### 扩展功能
- 支持更多数据类型导入
- 添加数据备份功能
- 支持多账号管理
- 添加数据统计功能